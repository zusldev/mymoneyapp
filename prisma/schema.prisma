generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Account {
  id            String         @id @default(cuid())
  name          String
  type          String
  balance       Float          @default(0)
  currency      String         @default("MXN")
  color         String         @default("#06b6d4")
  icon          String         @default("wallet")
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @updatedAt @map("updated_at")
  balanceCents  Int            @default(0) @map("balance_cents")
  incomes       Income[]
  subscriptions Subscription[]
  transactions  Transaction[]

  @@map("accounts")
}

model CreditCard {
  id               String         @id @default(cuid())
  name             String
  bank             String         @default("")
  lastFour         String         @default("") @map("last_four")
  credit_limit     Float
  balance          Float          @default(0)
  cutDate          Int            @default(1) @map("cut_date")
  payDate          Int            @default(20) @map("pay_date")
  apr              Float          @default(0)
  color            String         @default("#8b5cf6")
  createdAt        DateTime       @default(now()) @map("created_at")
  updatedAt        DateTime       @updatedAt @map("updated_at")
  creditLimitCents Int            @map("credit_limit_cents")
  balanceCents     Int            @default(0) @map("balance_cents")
  incomes          Income[]
  subscriptions    Subscription[]
  transactions     Transaction[]

  @@map("credit_cards")
}

model Transaction {
  id                 String        @id @default(cuid())
  /// Legacy major-unit mirror column in DB. Never use for calculations.
  legacyAmount       Float?        @map("amount")
  type               String
  date               DateTime      @default(now())
  merchant           String        @default("")
  merchantNormalized String        @default("") @map("merchant_normalized")
  description        String        @default("")
  category           String        @default("otros")
  isSubscription     Boolean       @default(false) @map("is_subscription")
  isFeeOrInterest    Boolean       @default(false) @map("is_fee_or_interest")
  confidenceScore    Int           @default(100) @map("confidence_score")
  accountId          String?       @map("account_id")
  creditCardId       String?       @map("credit_card_id")
  subscriptionId     String?       @map("subscription_id")
  createdAt          DateTime      @default(now()) @map("created_at")
  updatedAt          DateTime      @updatedAt @map("updated_at")
  amountCents        Int           @map("amount_cents")
  account            Account?      @relation(fields: [accountId], references: [id], onDelete: Cascade)
  creditCard         CreditCard?   @relation(fields: [creditCardId], references: [id], onDelete: Cascade)
  subscription       Subscription? @relation(fields: [subscriptionId], references: [id])

  @@index([date])
  @@index([category])
  @@index([accountId])
  @@index([creditCardId])
  @@map("transactions")
}

model Subscription {
  id           String        @id @default(cuid())
  name         String
  /// Legacy major-unit mirror column in DB. Never use for calculations.
  legacyAmount Float?        @map("amount")
  frequency    String        @default("monthly")
  category     String        @default("suscripciones")
  nextDate     DateTime      @map("next_date")
  active       Boolean       @default(true)
  color        String        @default("#f59e0b")
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")
  accountId    String?       @map("account_id")
  creditCardId String?       @map("credit_card_id")
  icon         String        @default("sync")
  type         String        @default("entertainment")
  amountCents  Int           @map("amount_cents")
  account      Account?      @relation(fields: [accountId], references: [id])
  creditCard   CreditCard?   @relation(fields: [creditCardId], references: [id])
  transactions Transaction[]

  @@map("subscriptions")
}

model Income {
  id           String      @id @default(cuid())
  name         String
  /// Legacy major-unit mirror column in DB. Never use for calculations.
  legacyAmount Float?      @map("amount")
  frequency    String      @default("monthly")
  nextDate     DateTime    @map("next_date")
  source       String      @default("")
  active       Boolean     @default(true)
  createdAt    DateTime    @default(now()) @map("created_at")
  updatedAt    DateTime    @updatedAt @map("updated_at")
  accountId    String?     @map("account_id")
  color        String      @default("#2badee")
  creditCardId String?     @map("credit_card_id")
  icon         String      @default("payments")
  type         String      @default("fixed")
  amountCents  Int         @map("amount_cents")
  account      Account?    @relation(fields: [accountId], references: [id])
  creditCard   CreditCard? @relation(fields: [creditCardId], references: [id])

  @@map("incomes")
}

model FinancialGoal {
  id                 String   @id @default(cuid())
  name               String
  target_amount      Float
  current_amount     Float    @default(0)
  deadline           DateTime
  priority           String   @default("medium")
  color              String   @default("#10b981")
  icon               String   @default("target")
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")
  targetAmountCents  Int      @map("target_amount_cents")
  currentAmountCents Int      @default(0) @map("current_amount_cents")

  @@map("financial_goals")
}

model ChatMessage {
  id        String   @id @default(cuid())
  role      String
  content   String
  createdAt DateTime @default(now()) @map("created_at")

  @@map("chat_messages")
}
